---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { BlogContent } from '@/components/BlogContent';

const posts = await getCollection('blog', ({ data }) => {
	return data.published === true;
});

// Sort posts by date descending
const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Map Astro collection to the metadata format expected by BlogContent
const mappedPosts = sortedPosts.map(post => ({
	slug: post.slug,
	title: post.data.title,
	date: post.data.date.toISOString(),
	description: post.data.description,
	published: post.data.published,
	tags: post.data.tags,
	author: post.data.author,
	coverImage: post.data.coverImage,
}));
---

<BaseLayout title="Blog | Insights & Tutorials" description="Technical articles on software engineering, AI/ML, and system architecture.">
	<main class="min-h-screen py-24 px-4 sm:px-6 lg:px-8 relative overflow-hidden">
		{/* Background decorative elements */}
		<div class="absolute top-0 left-0 w-full h-96 bg-gradient-to-b from-primary/5 to-transparent pointer-events-none" />
		
		<div class="max-w-7xl mx-auto relative z-10">
			{/* Header */}
			<div class="mb-20 pt-8 max-w-3xl">
				<h1 class="text-5xl md:text-7xl font-bold tracking-tight mb-6 text-foreground text-deep-shadow">
					<span class="text-transparent bg-clip-text bg-gradient-to-r from-foreground to-foreground/70">
						Engineering
					</span>
					<br />
					<span class="text-primary">Insights</span>
				</h1>
				<p class="text-xl text-muted-foreground leading-relaxed">
					Technical deep dives into architecture, <span class="text-foreground font-medium">Agentic AI</span>, and full-stack engineering.
				</p>
			</div>

			{mappedPosts.length > 0 ? (
				<BlogContent client:load initialPosts={mappedPosts} />
			) : (
				<div class="text-center py-24 border border-dashed border-border rounded-2xl bg-muted/5">
					<div class="inline-flex h-16 w-16 items-center justify-center rounded-full bg-muted mb-4">
						<svg
							class="h-8 w-8 text-muted-foreground"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width={1.5}
								d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"
							/>
						</svg>
					</div>
					<h3 class="text-xl font-medium text-foreground mb-2">No posts found</h3>
					<p class="text-muted-foreground">
						Check back soon for new articles.
					</p>
				</div>
			)}
		</div>
	</main>
</BaseLayout>